<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Setting up Gargoyle as a Time Server - BackSlasher</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.backslasher.net/setting-up-gargoyle-as-time-server.html">

        <meta name="author" content="Nitz" />
        <meta name="keywords" content="Mysteries Solved,Gargoyle,Linux,Raspberry Pi,Debian,raspberrySeed,NTP" />
        <meta name="description" content="The Story For reasons unknown to me, Debian&#39;s NTP daemon only works on udp port 123, even when operating as a client. This is a problem because my network configuration does not allow incoming packets on this port, thus preventing my raspberrySeed (raspberry pi running Debian, deluge, flexget) from syncing …" />

        <meta property="og:site_name" content="BackSlasher" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Setting up Gargoyle as a Time Server"/>
        <meta property="og:url" content="https://blog.backslasher.net/setting-up-gargoyle-as-time-server.html"/>
        <meta property="og:description" content="The Story For reasons unknown to me, Debian&#39;s NTP daemon only works on udp port 123, even when operating as a client. This is a problem because my network configuration does not allow incoming packets on this port, thus preventing my raspberrySeed (raspberry pi running Debian, deluge, flexget) from syncing …"/>
        <meta property="article:published_time" content="2014-06-11" />
            <meta property="article:section" content="FOSS" />
            <meta property="article:tag" content="Mysteries Solved" />
            <meta property="article:tag" content="Gargoyle" />
            <meta property="article:tag" content="Linux" />
            <meta property="article:tag" content="Raspberry Pi" />
            <meta property="article:tag" content="Debian" />
            <meta property="article:tag" content="raspberrySeed" />
            <meta property="article:tag" content="NTP" />
            <meta property="article:author" content="Nitz" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.backslasher.net/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.backslasher.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.backslasher.net/theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.backslasher.net/theme/css/style.css" type="text/css"/>

        <link href="https://blog.backslasher.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="BackSlasher ATOM Feed"/>

        <link href="https://blog.backslasher.net/feeds/foss.atom.xml" type="application/atom+xml" rel="alternate"
              title="BackSlasher FOSS ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.backslasher.net/" class="navbar-brand">
BackSlasher            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://blog.backslasher.net/pages/about.html">
                             About
                          </a></li>
                         <li><a href="https://blog.backslasher.net/pages/projects.html">
                             Projects
                          </a></li>
                        <li class="active">
                            <a href="https://blog.backslasher.net/category/foss.html">Foss</a>
                        </li>
                        <li >
                            <a href="https://blog.backslasher.net/category/microsoft.html">Microsoft</a>
                        </li>
                        <li >
                            <a href="https://blog.backslasher.net/category/misc.html">Misc</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.backslasher.net/setting-up-gargoyle-as-time-server.html"
                       rel="bookmark"
                       title="Permalink to Setting up Gargoyle as a Time Server">
                        Setting up Gargoyle as a Time Server
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-06-11T12:12:00+02:00"> Wed 11 June 2014</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://blog.backslasher.net/tag/mysteries-solved.html">Mysteries Solved</a>
        /
	<a href="https://blog.backslasher.net/tag/gargoyle.html">Gargoyle</a>
        /
	<a href="https://blog.backslasher.net/tag/linux.html">Linux</a>
        /
	<a href="https://blog.backslasher.net/tag/raspberry-pi.html">Raspberry Pi</a>
        /
	<a href="https://blog.backslasher.net/tag/debian.html">Debian</a>
        /
	<a href="https://blog.backslasher.net/tag/raspberryseed.html">raspberrySeed</a>
        /
	<a href="https://blog.backslasher.net/tag/ntp.html">NTP</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><span style="font-size: x-large;">The Story</span> <br>
For reasons unknown to me, Debian's NTP daemon only works on udp port
123, even when operating as a client.<br>
This is a problem because my network configuration does not allow
incoming packets on this port, thus preventing my raspberrySeed
(raspberry pi running Debian, deluge, flexget) from syncing, causing it
to slowly drift away from the real world.<br>
To solve the issue, I did two things:  </p>
<h3>The Solution</h3>
<h4>1. Turn Gargoyle into an NTP server</h4>
<p>Since Gargoyle is already syncing from outside, I only had to tell it to
act as a server.<br>
First, <code>ssh</code> into your gargoyle setup.<br>
Edit the file <code>/etc/config/system</code>, and under <code>timeserver</code>, change the
option <code>enable_server</code> to <code>'1'</code>.  </p>
<p><img alt="" src="https://blog.backslasher.net/images/setting-up-gargoyle-as-time-server/gargoyle-time-settings.png"></p>
<p>After editing the file, restart the service using   </p>
<div class="highlight"><pre><span></span><code>/etc/init.d/sysntpd restart
</code></pre></div>

<p>And ensure the argument <code>-l</code> was added to the ntp daemon command line,
using this code:   </p>
<div class="highlight"><pre><span></span><code>ps <span class="p">|</span> grep ntp
</code></pre></div>

<p><img alt="" src="https://blog.backslasher.net/images/setting-up-gargoyle-as-time-server/gargoyle-ntp-working.png"></p>
<h4>2. Tell debian to ask Gargoyle:</h4>
<p>ssh to your debian machine, and edit the file <code>/etc/ntp.conf</code>.<br>
Comment out all of the server entires, and only leave one pointing to
the name/IP address of Gargoyle:  </p>
<p><img alt="" src="https://blog.backslasher.net/images/setting-up-gargoyle-as-time-server/debian-ntp-config.png"></p>
<p>After that, restart the ntp daemon by running   </p>
<div class="highlight"><pre><span></span><code>sudo service ntp restart
</code></pre></div>

<p>Wait a couple of minutes and use this to test everything is OK:   </p>
<div class="highlight"><pre><span></span><code>ntpq -p
</code></pre></div>

<p>You should see one entry for your Gargoyle router, with the other fields
making sense (not all zeroes):<br>
<img alt="" src="https://blog.backslasher.net/images/setting-up-gargoyle-as-time-server/debian-time-ok.png"></p>
<p>Enjoy your new time configuration!</p>
            </div>
            <!-- /.entry-content -->

<div id="graphcomment"></div>
<script type="text/javascript">

  /* - - - CONFIGURATION VARIABLES - - - */

  // make sure the id is yours
  window.gc_params = {
    graphcomment_id: 'Backslasher-net',

    // if your website has a fixed header, indicate it's height in pixels
    fixed_header_height: 0,
  };

  /* - - - DON'T EDIT BELOW THIS LINE - - - */

  
  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.src = 'https://graphcomment.com/js/integration.js?' + Math.round(Math.random() * 1e8);
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();

</script>        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="http://github.com/BackSlasher"><i class="fa fa-github-square fa-lg"></i> github</a></li>
    <li class="list-group-item"><a href="http://il.linkedin.com/in/nitzanraz/"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
    <li class="list-group-item"><a href="http://careers.stackoverflow.com/backslasher"><i class="fa fa-stack-overflow fa-lg"></i> stack-overflow</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://blog.backslasher.net/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group " id="tags">
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/scripts.html">Scripts</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/powershell.html">PowerShell</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/linux.html">Linux</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/security.html">Security</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/mysteries-solved.html">Mysteries Solved</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.backslasher.net/tag/active-directory.html">Active Directory</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/ruby.html">Ruby</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/windows.html">Windows</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/chef.html">Chef</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/bash.html">Bash</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/ramblings.html">Ramblings</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/python.html">Python</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/one-liner.html">One-Liner</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/group-policy.html">Group Policy</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.backslasher.net/tag/sharepoint.html">SharePoint</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.backslasher.net/tag/http.html">HTTP</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.backslasher.net/tag/registry.html">Registry</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://blog.backslasher.net/tag/filesystem.html">FileSystem</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://blog.backslasher.net/tag/programming.html">Programming</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://blog.backslasher.net/tag/kerberos.html">Kerberos</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://getpelican.com/" target="_blank">Pelican</a>
    </li>
    <li class="list-group-item">
      <a href="http://python.org/" target="_blank">Python.org</a>
    </li>
    <li class="list-group-item">
      <a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 Nitz
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.backslasher.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.backslasher.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.backslasher.net/theme/js/respond.min.js"></script>


    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-9527207-7', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->


</body>
</html>